---
git:
  depth: 5
language: cpp
sudo: required

services:
  - docker

before_install:
  - 'sed -i "s/rpmbuild_uid\: 1000/rpmbuild_uid\: $(id -u)/" config.yml'

jobs:
  include:
    - stage: lint
      script:
        - |
          docker run \
            -v $TRAVIS_BUILD_DIR:/rpmbuild/hootenanny-rpms:rw \
            -w /rpmbuild/hootenanny-rpms \
            -it --rm \
            hootenanny/rpmbuild-lint@sha256:34d389aad27cb6cd10d158063718d5e47d7a7d96d2211e0bbe8f621f57803fa8 \
            bash -c "./tests/lint-yaml.sh && ./tests/lint-bash.sh"
    - stage: rpm
      script:
        - |
          sudo apt-get update -qq
          sudo apt-get install -qq -y rpm
          ./scripts/vagrant-install.sh
          MAVEN_CACHE=0 vagrant validate
          make rpmbuild-hoot-release
